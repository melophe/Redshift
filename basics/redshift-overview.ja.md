# Redshift 概要

## アーキテクチャ

```
┌─────────────────────────────────────────────────┐
│                  Leader Node                     │
│  - SQLの解析                                     │
│  - クエリプランの作成                             │
│  - 結果の集約                                    │
└─────────────────────┬───────────────────────────┘
                      │
        ┌─────────────┼─────────────┐
        ▼             ▼             ▼
┌───────────┐  ┌───────────┐  ┌───────────┐
│  Compute  │  │  Compute  │  │  Compute  │
│  Node 1   │  │  Node 2   │  │  Node 3   │
│           │  │           │  │           │
│  Slices   │  │  Slices   │  │  Slices   │
└───────────┘  └───────────┘  └───────────┘
```

### コンポーネント

1. **Leader Node（リーダーノード）**
   - クライアントからクエリを受信
   - 解析して実行プランを作成
   - コンピュートノードに処理を分散
   - 結果を集約してクライアントに返す

2. **Compute Nodes（コンピュートノード）**
   - データを保存
   - クエリを並列実行
   - 各ノードには複数の「スライス」がある

3. **Slices（スライス）**
   - 各スライスがデータの一部を処理
   - ノード内の並列処理単位

## カラムナストレージ（列指向）

従来の行指向 vs Redshiftの列指向:

```
行指向 (OLTP):
┌────┬───────┬─────┬────────┐
│ ID │ Name  │ Age │ Salary │  ← Row 1
├────┼───────┼─────┼────────┤
│ ID │ Name  │ Age │ Salary │  ← Row 2
└────┴───────┴─────┴────────┘

列指向 (Redshift):
┌────┬────┬────┐  ┌───────┬───────┬───────┐
│ ID │ ID │ ID │  │ Name  │ Name  │ Name  │  ...
└────┴────┴────┘  └───────┴───────┴───────┘
   Column 1            Column 2
```

### カラムナストレージの利点

1. **I/Oの削減** - クエリに必要な列だけを読み込む
2. **高圧縮率** - 同じデータ型が連続するため圧縮効率が良い
3. **ベクトル処理** - 列データを効率的に処理

## ノードタイプ

| タイプ | 用途 |
|--------|------|
| **RA3** | 推奨。マネージドストレージ、コンピュートとストレージを別々に課金 |
| **DC2** | Dense Compute。高速SSD、1TB未満に適する |
| **DS2** | Dense Storage。レガシー、RA3を使うべき |

## Redshift Serverless vs Provisioned

| | Provisioned | Serverless |
|---|-------------|------------|
| 管理 | 手動でクラスタサイズを設定 | 自動スケーリング |
| 料金 | ノード単位の時間課金 | RPU（処理単位）の使用量課金 |
| 用途 | 予測可能なワークロード | 変動するワークロード |
